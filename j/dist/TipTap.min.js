(function(a,b,c){"use strict";var d={debugMe:!0,device:null,DEVICE_DEFAULT:0,DEVICE_MOUSE:1,DEVICE_TOUCH:2,GLOBAL_CLASS_FILTER:"-",listOfFingers:[],listOfRouters:[],touch:"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch,TOUCH_REFRESH_ms:1e3/60,use$:!0,disable:function(a){},enable:function(a){},findFingerByIdentifier:function(a){return _.find(this.listOfFingers,function(b){return b.identifier===a})},getEvent:function(a){return this.use$?a.originalEvent:a},init:function(a){this.settings=_.extend(this.settings,a),this.settings.deviceType===this.DEVICE_TOUCH||this.touch?this.device=new d.Touch:this.device=new d.Mouse,d.use$?c(b).bind(this.device.DRAG_EVENT+".TipTap",_.bind(d.onDrag,d)).bind(this.device.END_EVENT+".TipTap",_.bind(d.onEnd,d)).bind(this.device.CANCEL_EVENT+".TipTap",_.bind(d.onCancel,d)):(b.addEventListener(this.device.DRAG_EVENT,_.bind(d.onDrag,d)),b.addEventListener(this.device.END_EVENT,_.bind(d.onEnd,d)),b.addEventListener(this.device.CANCEL_EVENT,_.bind(d.onCancel,d)))},on:function(a,b,e,f,g){typeof e=="function"&&(g=f,f=e,e="");var h=this;return a.each(function(){var a=c(this),i=_.find(h.listOfRouters,function(b){return b.$el.is(a)});return i||(i=new d.Router(a,h.device),h.listOfRouters.push(i),h.use$&&a.bind(h.device.START_EVENT+".TipTap",_.bind(h.onStart,h,i))),i.bindCombos(b,e,f,g),a})},onStart:function(a,b){var c=this.debugMe&&d.settings.debug,e=Date.now();md(this+".onStart-1: "+e+"<hr/>",c),d.CANCEL_BUBBLING===_.reduce(this.device.buildEtList(b),_.bind(this.onStartDo,this,a),d.KEEP_BUBBLING,this)&&this.stopEvent(b),md(this+".onStart-2: "+(Date.now()-e)+" ms",c)},onStartDo:function(a,b,c){var e=this.debugMe&&d.settings.debug,f,g;return md(this+".onStartDo-1",e),g=a.findMatchingFilterForEvent(c.$target),g?(md(this+".onStartDo-2",e),f=new d.Finger(c),this.listOfFingers.push(f),a.allocateAction(f),md(this+".onStartDo-3",e),this.device.onStart(),f.onStart(c),md(this+".onStartDo-4",e),d.CANCEL_BUBBLING):b},onDrag:function(a){var b=this.debugMe&&d.settings.debug,c=d.KEEP_BUBBLING,e=Date.now();if(!this.device.shouldCaptureDrag())return;this.device.onDrag(a),_.each(this.device.buildEtList(a),function(f){var g=this.findFingerByIdentifier(f.identifier);if(!g)return;md(this+".onDrag: "+e+",l="+this.device.buildEtList(a).length+"<hr/>",b),c=d.CANCEL_BUBBLING,g.onDrag(f)},this),c&&this.stopEvent(a)},onEnd:function(a){var b=this.debugMe&&d.settings.debug;md(this+".onEnd",b),_.reduce(this.device.buildEtList(a),_.bind(this.onEndDo,this),d.KEEP_BUBBLING,this)&&this.stopEvent(a)},onEndDo:function(a,b){var c=this.findFingerByIdentifier(b.identifier);return c?(this.device.onEnd(b),c.onEnd(b),this.unlinkFinger(c),d.CANCEL_BUBBLING):a},onCancel:function(a){md(this+".onCancel",debugMe),this.onEnd(a)},stopEvent:function(a){a=d.getEvent(a),a.preventDefault()},toString:function(){return"TipTap"},unlinkFinger:function(a){var b=this.debugMe&&d.settings.debug,c=this.listOfFingers.length;this.listOfFingers.splice(this.listOfFingers.indexOf(a),1),md(this+".unlinkFinger: "+c+" -> "+this.listOfFingers.length,b)}};d.settings={deviceType:d.DEVICE_MOUSE,simultaneousMovesTimer_ms:3*d.TOUCH_REFRESH_ms,tapMaxDuration_ms:150,swipeStartDelay_ms:2*d.TOUCH_REFRESH_ms,swipeDuration_ms:8*d.TOUCH_REFRESH_ms,swipeMinDisplacement_px:8,swipeMaxDistance_px:160,moveThreshold_px:d.touch?8:0,comboEndTimer_ms:100,comboGesturesSep:">",ComboParallelActionOperator:"-",ComboAlternateOperator:"|",debug:!0},a.TipTap=d;var e={activate:function(){return d.activate(this)},on:function(a,b,c,e){return d.on(this,a,b,c,e)},deactivate:function(){return d.deactivate(this)},off:function(){}};c&&(c.fn.jTipTap=function(a,b,d,f){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));if(typeof a=="object"||!a)return e.init.apply(this,arguments);c.error("Method "+a+" does not exist in jQuery.TipTap")})})(window,document,window.jQuery),TipTap.KEEP_BUBBLING=!1,TipTap.CANCEL_BUBBLING=!0;var md=function(){var a=$("#debuglog");return function(b,c,d){c&&(d&&(b='<span style="color:'+d+'">'+b+"</span>"),a.prepend(b+"<br/>"))}}();(function(a,b){var c=function(a){this.effects={},this.initialState="",this.state="",a||(a=c.SAVE_STATE),this.saveState=a};c._SELF="_self",c._CALC="_calc",c.SAVE_STATE=!1,c.DONT_SAVE_STATE=!0,c.prototype={doTransition:function(a,b){var d,e,f;this.saveState===c.SAVE_STATE?f=this:(f=a,f.state||(f.state=this.initialState)),d=this.effects[f.state+b];if(!d)return;e=d.action.apply(a,Array.prototype.slice.call(arguments,2))||c._SELF;if(d.to===c._SELF)return;if(d.to===c._CALC){if(e===c._SELF)return;f.state=e}else f.state=d.to},init:function(a){return b.each(a,function(a){this.state||(this.state=a.from),a.isStart&&(this.state=this.initialState=a.from),this.parseState(a)},this),this.initialState},parseState:function(a){b.each(a.transitions,function(c){var d=c.signal;typeof d=="string"&&(d=[d]),b.each(d,function(b){this.storeTransition(a.from,c,b)},this)},this)},storeTransition:function(a,b,d){this.effects[a+d]={action:b.action,to:b.to||c._SELF},this[d]=function(a){return function(){var b=[this,d].concat(Array.prototype.slice.call(arguments));return a.doTransition.apply(a,b)}}(this)},toString:function(){return"FSM"}},a.Fsm=c})(window.TipTap,_),function(a,b){var c=function(b,d){this.debugMe=!1;var e=this.debugMe&&a.settings.debug;this.id=c.id(),this.debugColor="#"+Math.round(Math.random()*Math.pow(2,24)).toString(16),this.status=b,this.direction=d,this.listOfPointers=[],this.birthTime=Date.now(),md(this+".new("+c.statusMatchCode[c.getFullStatus(this.status,this.direction)].code+")",e,this.debugColor)};c.prototype={addPointer:function(a){var b=this.listOfPointers.length,c=0;while(c<b&&this.listOfPointers[c].identifier<a.identifier)c++;c===b?this.listOfPointers.push(a):this.listOfPointers.splice(c,0,a)},age:function(){return Date.now()-this.birthTime},calculateZoomAndRotation:function(){var b=this.debugMe&&a.settings.debug,c=this.listOfPointers[0],d=this.listOfPointers[1],e=this.calculateVector(c.initialPosition,d.initialPosition),f=this.calculateVector(c.position,d.position);this.zoom=f.len/e.len,this.rotation=f.rot-e.rot,md(this+".calculateZoomAndRotation("+this.zoom+", "+this.rotation+")",b)},calculateZoomFactor:function(a,b,c){var d,e;d=(c-b)/a.initialFingersDistance,a.relativeZoom=d/a.absoluteZoom,a.absoluteZoom=d},canThisPointerBeAdded:function(b){var d=this.debugMe&&a.settings.debug;return md(this+".canThisPointerBeAdded("+c.statusMatchCode[c.getFullStatus(this.status,this.direction)].code+" =?= "+c.statusMatchCode[c.getFullStatus(b.status,b.direction)].code+", "+b.identifier+")",d,this.debugColor),this.status===b.status&&this.direction===b.direction&&!this.hasPointerFromSameFinger(b)},format:function(){var b=this.debugMe&&a.settings.debug,d=c.formatGesture(this.status,this.direction,this.pointersCount());return md(this+".format: "+d,b,this.debugColor),d},getPointer:function(a){return a<0?null:a>=this.listOfPointers.length?null:this.listOfPointers[a]},hasPointerFromSameFinger:function(c){var d=this.debugMe&&a.settings.debug,e;return e=b.find(this.listOfPointers,function(a){return a.identifier===c.identifier}),md(this+".hasPointerFromSameFinger => "+e,d,this.debugColor),e},isEmpty:function(){var b=this.debugMe&&a.settings.debug;return!this.listOfPointers.length},pointersCount:function(){var b=this.debugMe&&a.settings.debug;return this.listOfPointers.length},toString:function(){return"--G#"+this.id+c.statusMatchCode[this.status].code}},c.formatGesture=function(b,d,e){var f=this.debugMe&&a.settings.debug,g,h="",i;arguments.length===2&&(e=d,d=a.Finger._DIR_NONE),i=c.getMatchCode(b,d);if(!e)return"";for(g=0;g<e;g++)h+=i;return md("Gesture.formatGesture: "+h,f),h},c.getMatchCode=function(a,b){return c.statusMatchCode[c.getFullStatus(a,b)].letter},c.getFullStatus=function(b,d){if(b!==c._SWIPED)return b;switch(d){case a.Finger._DIR_TOP:return c._SWIPED_T;case a.Finger._DIR_BOTTOM:return c._SWIPED_B;case a.Finger._DIR_LEFT:return c._SWIPED_L;default:return c._SWIPED_R}},c.id=function(){return c._id++,c._id},c._id=0,c._VOID=0,c._PRESSED=c._VOID+1,c._TAPPED=c._PRESSED+1,c._UNTIPPED=c._TAPPED+1,c._TIPPED=c._UNTIPPED+1,c._DRAG_STARTED=c._TIPPED+1,c._DRAG_STOPPED=c._DRAG_STARTED+1,c._DRAGGED=c._DRAG_STOPPED+1,c._RELEASED=c._DRAGGED+1,c._SWIPED_T=c._RELEASED+1,c._SWIPED_R=c._SWIPED_T+1,c._SWIPED_B=c._SWIPED_R+1,c._SWIPED_L=c._SWIPED_B+1,c._SWIPED=c._SWIPED_L+1,c.statusMatchCode=[],c.statusMatchCode[c._VOID]={code:"void",letter:"A"},c.statusMatchCode[c._PRESSED]={code:"press",letter:"B"},c.statusMatchCode[c._TAPPED]={code:"tap",letter:"C"},c.statusMatchCode[c._UNTIPPED]={code:"untip",letter:"D"},c.statusMatchCode[c._TIPPED]={code:"tip",letter:"E"},c.statusMatchCode[c._DRAG_STARTED]={code:"dragStart",letter:"F"},c.statusMatchCode[c._DRAG_STOPPED]={code:"dragStop",letter:"G"},c.statusMatchCode[c._DRAGGED]={code:"drag",letter:"H"},c.statusMatchCode[c._RELEASED]={code:"release",letter:"I"},c.statusMatchCode[c._SWIPED_T]={code:"swipe_t",letter:"J"},c.statusMatchCode[c._SWIPED_R]={code:"swipe_r",letter:"K"},c.statusMatchCode[c._SWIPED_B]={code:"swipe_b",letter:"L"},c.statusMatchCode[c._SWIPED_L]={code:"swipe_l",letter:"M"},c.statusMatchCode[c._SWIPED]={code:"swipe",letter:"N"},a.Gesture=c}(window.TipTap,_),function(a,b){var c=function(b){var d=this.debugMe&&a.settings.debug;this.debugMe=!0,md(this+".new("+b[0].id+'")',d),this.$target=b,this.endComboAndMaybeActionTimer=0,this.fifoOfGestures=[],this.gesture=null,this.id=c.id(),this.listOfFormattedGestures=[],this.pressedPointersCount=0,this.processGestureTimer=0,a.settings.rotoZoom&&(this.rotoZoomer=new a.RotoZoomer(this.$target,!0,!0,!0)),this.createSignals()};c.prototype={addFingerListeners:function(c){c.pressed.add(b.bind(this.allocateGesture,this,a.Gesture._PRESSED),this),c.tapped.add(b.bind(this.allocateGesture,this,a.Gesture._TAPPED),this),c.tipped.add(b.bind(this.allocateGesture,this,a.Gesture._TIPPED),this),c.untipped.add(b.bind(this.allocateGesture,this,a.Gesture._UNTIPPED),this),c.swiped.add(b.bind(this.allocateGesture,this,a.Gesture._SWIPED),this),c.dragStarted.add(b.bind(this.allocateGesture,this,a.Gesture._DRAG_STARTED),this),c.dragged.add(b.bind(this.allocateGesture,this,a.Gesture._DRAGGED),this),c.dragStopped.add(b.bind(this.allocateGesture,this,a.Gesture._DRAG_STOPPED),this),c.released.add(b.bind(this.allocateGesture,this,a.Gesture._RELEASED),this)},allocateGesture:function(c,d){var e=this.debugMe&&a.settings.debug,f,g;return md(this+".allocateGesture-1("+a.Gesture.statusMatchCode[c].code+")",e),g=new a.Pointer(d,c),a.Gesture._PRESSED===c&&this.cancelSendComboAndEndActionTimer(),f=b.find(this.fifoOfGestures,function(a){return a.canThisPointerBeAdded(g)},this),f?md(this+".allocateGesture-using gesture "+f,e,"#00F"):(md(this+".allocateGesture-must create new Gesture",e),f=new a.Gesture(c,d.getDirection()),this.storeGesture(f)),this.startGesturesListProcessingTimer(),md(this+".allocateGesture-4",e),f.addPointer(g),f},buildAndSendNotificationGesture:function(a){this.gesture=a,this.listOfPointers=a.listOfPointers,this.sendCombo.dispatch(this,this.formatGesture(a))},buildComboClearGesturesAndSendCombo:function(b){var c=this.debugMe&&a.settings.debug,d=this.listOfFormattedGestures.join(a.settings.comboGesturesSep);md(this+".buildComboFromGestures-1:["+d+"]",c),this.clearListOfFormattedGestures(),this.sendCombo.dispatch(this,d,b)},cancelSendComboAndEndActionTimer:function(){var b=this.debugMe&&a.settings.debug;md(this+".cancelSendComboAndEndActionTimer-1",b,""),this.endComboAndMaybeActionTimer&&(md(this+".cancelSendComboAndEndActionTimer-clearTimeout",b,""),clearTimeout(this.endComboAndMaybeActionTimer),this.endComboAndMaybeActionTimer=0)},clearListOfFormattedGestures:function(){this.listOfFormattedGestures.length=0},consumeDoneGesturesFromFIFO:function(){var b=this.debugMe&&a.settings.debug,c;this.processGestureTimer=0,md(this+".consumeDoneGesturesFromFIFO-1",b);while(this.fifoOfGestures.length){c=this.fifoOfGestures[0],md(this+".consumeDoneGesturesFromFIFO-treating("+c+"."+c.status+")",b);if(a.settings.simultaneousMovesTimer_ms>c.age()&&c.status!==a.Gesture._DRAGGED){md(this+".consumeDoneGesturesFromFIFO-too young and != 'dragged', EXITING",b),this.startGesturesListProcessingTimer();return}this.fifoOfGestures.shift(),this[a.Gesture.statusMatchCode[c.status].code].call(this,c)}},createSignals:function(){var a=signals.Signal;this.pressed=new a,this.sendCombo=new a,this.dragStarted=new a,this.dragged=new a,this.dragStopped=new a,this.released=new a,this.finished=new a},endComboAndMaybeAction:function(b){var c=this.debugMe&&a.settings.debug,d;md(this+".sendComboAndEndAction-1("+this.endComboAndMaybeActionTimer+", "+b+")",c,""),this.endComboAndMaybeActionTimer=0,this.buildComboClearGesturesAndSendCombo(b),this.terminateIfEmpty()},formatGesture:function(b){var c=this.debugMe&&a.settings.debug,d,e=b.format();return d=a.Gesture.formatGesture(a.Gesture._TIPPED,this.pressedPointersCount),d&&(e=d+a.settings.ComboParallelActionOperator+e),md(this+".formatGesture-1("+e+")",c),e},formatAndStoreGesture:function(b){var c=this.debugMe&&a.settings.debug;md(this+".formatAndStoreGesture("+b+","+this.formatGesture(b)+")",c,"#F00"),this.listOfFormattedGestures.push(this.formatGesture(b))},getPointer:function(a){return this.gesture.getPointer(a)},hasPressedPointers:function(){return this.pressedPointersCount>0},startGesturesListProcessingTimer:function(){var c=this.debugMe&&a.settings.debug;if(this.processGestureTimer){md(this+".startProcessGestureTimer-no need to start timer",c);return}this.processGestureTimer=setTimeout(b.bind(this.consumeDoneGesturesFromFIFO,this),a.settings.simultaneousMovesTimer_ms/4),md(this+".startProcessGestureTimer-timer started("+this.processGestureTimer+")",c)},startSendComboAndEndActionTimer:function(c){var d=this.debugMe&&a.settings.debug;this.endComboAndMaybeActionTimer=setTimeout(b.bind(this.endComboAndMaybeAction,this,c),a.settings.comboEndTimer_ms),md(this+".startSendComboAndEndActionTimer-1("+c+", "+this.endComboAndMaybeActionTimer+")",d,"")},storeGesture:function(a){this.fifoOfGestures.push(a)},terminateIfEmpty:function(){var b=this.debugMe&&a.settings.debug;if(this.hasPressedPointers())return;md(this+".terminateIfEmpty-1",b),this.finished.dispatch(this)},toString:function(){return"-A#"+this.id},zoomElement:function(){var b=this.debugMe&&a.settings.debug,c=this.$target,d,e;d=this.fingersBoundingBox,e=this.elementGeometry,c.width(d.width+e.width).height(d.height+e.height),c.offset({left:d.left+e.left,top:d.top+e.top})}};var d=a.Gesture;c.prototype[d.statusMatchCode[d._PRESSED].code]=function(b){a.settings.rotoZoom&&this.rotoZoomer.onPressed(b),this.buildAndSendNotificationGesture(b)},c.prototype[d.statusMatchCode[d._SWIPED].code]=c.prototype[d.statusMatchCode[d._TAPPED].code]=function(a){this.cancelSendComboAndEndActionTimer(),this.formatAndStoreGesture(a),this.startSendComboAndEndActionTimer(a)},c.prototype[d.statusMatchCode[d._TIPPED].code]=function(b){var c=this.debugMe&&a.settings.debug;this.formatAndStoreGesture(b),this.pressedPointersCount+=b.pointersCount(),this.buildComboClearGesturesAndSendCombo(b)},c.prototype[d.statusMatchCode[d._UNTIPPED].code]=function(b){var c=this.debugMe&&a.settings.debug;this.pressedPointersCount-=b.pointersCount(),this.formatAndStoreGesture(b),this.cancelSendComboAndEndActionTimer(),this.buildComboClearGesturesAndSendCombo(b),this.terminateIfEmpty()},c.prototype[d.statusMatchCode[d._DRAG_STARTED].code]=function(a){this.buildAndSendNotificationGesture(a)},c.prototype[d.statusMatchCode[d._DRAGGED].code]=function(b){var c=this.debugMe&&a.settings.debug;md(this+".drag",c),a.settings.rotoZoom&&this.rotoZoomer.onDrag(b),this.gesture=b,this.dragged.dispatch(this,b.format())},c.prototype[d.statusMatchCode[d._DRAG_STOPPED].code]=function(b){a.settings.rotoZoom&&this.rotoZoomer.onStoppedDragging(b),this.buildAndSendNotificationGesture(b)},c.prototype[d.statusMatchCode[d._RELEASED].code]=function(b){a.settings.rotoZoom&&this.rotoZoomer.onReleased(b),this.buildAndSendNotificationGesture(b)},c.id=function(){return c._id++,c._id},c._id=0,a.Action=c}(window.TipTap,_),function(a,b){var c=function(b){this.debugMe=!0;var d=a.settings.debug&&this.debugMe;this.listOfPositions=[],this.identifier=b.identifier,this.$target=b.$target,this.direction=c._DIR_NONE,this.absDrag={dx:0,dy:0,d:0,spx:0,spy:0,spd:0,duration_ms:0},this.dragDetailsRelative={dx:0,dy:0,d:0,spx:0,spy:0,spd:0,duration_ms:0},this.pressedToTippedTimer=0,this.createSignals(),this.storePosition(b),md(this+".new()",d)};c.fsm=new a.Fsm(a.Fsm.DONT_SAVE_STATE),c.fsm.init([{from:"start",isStart:!0,transitions:[{signal:"pressed",to:"pressing",action:function(){var b=a.settings.debug&&this.debugMe,c=this.getPosition();this.startPressedToTippedTimer(),this.pressed.dispatch(this),md(this+"-fsm(start-pressed-pressing),("+c.pageX+"px, "+c.pageY+"px)",b)}}]},{from:"pressing",transitions:[{signal:"pressedToTipped",to:"tipping",action:function(){var b=a.settings.debug&&this.debugMe;md(this+"-fsm(pressing-pressedToTipped-tipping)",b),this.tipped.dispatch(this)}},{signal:"dragged",to:a.Fsm._CALC,action:function(){var b=a.settings.debug&&this.debugMe,c;return this.wasAnUncontrolledMove()?(md(this+"-fsm(pressing-dragged-1)",b),this.cancelPressedToTippedTimer(),c=this.isSwipingOrDragging(),md(this+"-fsm(pressing-dragged-2)",b),c==="swiping"?c:(md(this+"-fsm(pressing-dragged-3)",b),this.dragStarted.dispatch(this),this.dragged.dispatch(this),"dragging")):a.Fsm._SELF}},{signal:["ended","cancelled"],to:"end",action:function(){var b=a.settings.debug&&this.debugMe;this.cancelPressedToTippedTimer(),md(this+"-fsm(pressing-ended-end)",b),this.tapped.dispatch(this),this.released.dispatch(this)}}]},{from:"tipping",transitions:[{signal:"dragged",to:a.Fsm._CALC,action:function(){var b=a.settings.debug&&this.debugMe;return this.wasAnUncontrolledMove()?(md(this+"-fsm(tipping-dragged-1)",b),this.dragStarted.dispatch(this),this.dragged.dispatch(this),md(this+"-fsm(tipping-dragged-2)",b),"dragging"):a.Fsm._SELF}},{signal:["ended","cancelled"],to:"end",action:function(){var b=a.settings.debug&&this.debugMe;md(this+"-fsm(tipping-ended)",b),this.untipped.dispatch(this),this.released.dispatch(this)}}]},{from:"dragging",transitions:[{signal:"dragged",action:function(){var b=a.settings.debug&&this.debugMe;md(this+"-fsm(dragging-dragged-1)",b),this.dragged.dispatch(this)}},{signal:["ended","cancelled"],to:"end",action:function(){var b=a.settings.debug&&this.debugMe;this.dragStopped.dispatch(this),md(this+"-fsm(dragging-ended-1)",b),this.untipped.dispatch(this),this.released.dispatch(this)}}]},{from:"swiping",transitions:[{signal:"dragged",to:a.Fsm._CALC,action:function(){var b=a.settings.debug&&this.debugMe;return this.notSwipingAnymore()?(this.dragStarted.dispatch(this),md(this+"-fsm(swiping-dragged-1)",b),this.dragged.dispatch(this),"dragging"):a.Fsm._SELF}},{signal:["ended","cancelled"],to:"end",action:function(){var b=a.settings.debug&&this.debugMe;md(this+"-fsm(swiping-ended-1)",b),this.swiped.dispatch(this),this.released.dispatch(this)}}]}]),c._DIR_NONE=0,c._DIR_TOP=1,c._DIR_RIGHT=2,c._DIR_BOTTOM=4,c._DIR_LEFT=8,c.prototype={addPosition:function(a){this.listOfPositions.push(a)},cancelPressedToTippedTimer:function(){var b=a.settings.debug&&this.debugMe;md(this+".cancelPressedToTippedTimer-1",b),this.pressedToTippedTimer&&(md(this+".cancelPressedToTippedTimer-2",b),clearTimeout(this.pressedToTippedTimer),this.pressedToTippedTimer=0)},_computeMove:function(a,b){var c=this.listOfPositions[a],d=this.listOfPositions[b],e=d.pageX-c.pageX,f=d.pageY-c.pageY,g=Math.sqrt(e*e+f*f),h=d.timeStamp-c.timeStamp,i=e/h,j=f/h,k=g/h;return{dx:e,dy:f,d:g,spx:i,spy:j,spd:k,duration_ms:h}},computeAbsMove:function(){return this._computeMove(0,this.listOfPositions.length-1)},computeRelMove:function(){return this._computeMove(this.listOfPositions.length-2,this.listOfPositions.length-1)},createSignals:function(){var a=signals.Signal;this.pressed=new a,this.tapped=new a,this.tipped=new a,this.untipped=new a,this.swiped=new a,this.dragStarted=new a,this.dragged=new a,this.dragStopped=new a,this.released=new a},getDirection:function(){return this.direction},getInitialPosition:function(){return this.listOfPositions[0]},getPosition:function(){return this.listOfPositions[this.listOfPositions.length-1]},getState:function(){return this.state},isSwipingOrDragging:function(){var b=a.settings.debug&&this.debugMe,d=a.settings,e,f,g,h;return e=this.dragDetailsRelative.dx,g=Math.abs(e),f=this.dragDetailsRelative.dy,h=Math.abs(f),md(this+".isSwipingOrDragging-1: "+this.absDrag.duration_ms+"px",b),this.absDrag.duration_ms<=d.swipeStartDelay_ms?(md(this+".isSwipingOrDragging-2",b),g>=h?g>=d.swipeMinDisplacement_px&&(e>0?(md(this+".isSwipingOrDragging > swipe-r",b),this.direction=c._DIR_RIGHT):(md(this+".isSwipingOrDragging > swipe-l",b),this.direction=c._DIR_LEFT)):h>=d.swipeMinDisplacement_px&&(f>0?(md(this+".isSwipingOrDragging > swipe-b",b),this.direction=c._DIR_BOTTOM):(md(this+".isSwipingOrDragging > swipe-t",b),this.direction=c._DIR_TOP)),"swiping"):"tipping"},notSwipingAnymore:function(){var b=a.settings.debug&&this.debugMe,c=a.settings;return md(this+".notSwipingAnymore: "+this.absDrag.duration_ms+"ms, "+this.absDrag.d+"px",b),this.absDrag.duration_ms>c.swipeDuration_ms||this.absDrag.d>c.swipeMaxDistance_px},onDrag:function(b){var d=a.settings.debug&&this.debugMe;this.storePosition(b),this.absDrag=this.computeAbsMove(),this.dragDetailsRelative=this.computeRelMove(),c.fsm.dragged.call(this)},onEnd:function(a){this.storePosition(a),c.fsm.ended.call(this)},onStart:function(){c.fsm.pressed.call(this)},pressedToTipped:function(){c.fsm.pressedToTipped.call(this)},startPressedToTippedTimer:function(){var c=a.settings.debug&&this.debugMe;md(this+".startPressedToTippedTimer-1",c),this.pressedToTippedTimer||(md(this+".startPressedToTippedTimer-2",c),this.pressedToTippedTimer=setTimeout(b.bind(this.pressedToTipped,this),a.settings.tapMaxDuration_ms))},storePosition:function(b){this.addPosition(new a.Position(b))},toString:function(){return"---F#"+this.identifier},wasAnUncontrolledMove:function(){var b=a.settings.debug&&this.debugMe,c=a.settings;return md(this+".wasAnUncontrolledMove",b),Math.abs(this.absDrag.dx)>c.moveThreshold_px||Math.abs(this.absDrag.dy)>c.moveThreshold_px}},a.Finger=c}(window.TipTap,_),function(a,b,c){var d=function(){this.debugMe=!0,this.mouseDown=!1,this.identifier=this.generateIdentifier(),this.START_EVENT="mousedown",this.DRAG_EVENT="mousemove",this.END_EVENT="mouseup",this.CANCEL_EVENT="mousecancel"};d.prototype={buildEtList:function(a){return a.button!==0?[]:(a.identifier=this.identifier,a.$target=c(a.target),[a])},generateIdentifier:function(){return this.identifier?this.identifier+1:Math.pow(2,32)*Math.random()},onStart:function(a){this.mouseDown=!0},onDrag:function(a){},onEnd:function(a){this.mouseDown=!1,this.identifier=this.generateIdentifier()},onCancel:function(a){this.onEnd(a)},shouldCaptureDrag:function(a){return this.mouseDown}},a.Mouse=d}(window.TipTap,_,window.jQuery),function(a,b){var c=function(a,b){this.identifier=a.identifier,this.$target=a.$target,this.pageX=a.getPosition().pageX,this.pageY=a.getPosition().pageY,this.status=b,this.direction=a.getDirection()};c.prototype={toString:function(){return"Ptr#"+this.identifier}},a.Pointer=c}(window.TipTap,_),function(a){var b=function(a){this.timeStamp=a.timeStamp,this.pageX=a.pageX,this.pageY=a.pageY};b.prototype={toString:function(){return"Pos#"+this.identifier+"("+this.pageX+","+this.pageY+")"}},a.Position=b}(window.TipTap),function(a,b){var c=function(b,c,d,e){this.debugMe=!1;var f=this.debugMe&&a.settings.debug;this.$target=b,this.target=b[0],this.touches=[],b.data("rotoZoomer-matrix")?(this.matrix=b.data("rotoZoomer-matrix").split(","),this.rotateable=b.data("rotoZoomer-rotateable"),this.zoomable=b.data("rotoZoomer-zoomable"),this.autoApply=b.data("rotoZoomer-autoapply"),md("<b>"+this+".new, data read(m: ["+b.data("rotoZoomer-matrix")+"], rotateable: "+b.data("rotoZoomer-rotateable")+", zoomable: "+b.data("rotoZoomer-zoomable")+", autoApply: "+b.data("rotoZoomer-autoapply")+")</b>",f)):(this.matrix=[1,0,0,1,0,0],this.rotateable=c,this.zoomable=d,this.autoApply=e,md("<b>"+this+".new, data (m: [1, 0, 0, 1, 0, 0], rotateable: "+c+", zoomable: "+d+", autoApply: "+e+")</b>",f),this.touchDist=0,this.touchRot=0,this.setTransform(0,1,0,0))};c.prototype={addTouch:function(a){var b=this.touches,c=b.length,d=0;while(d<c&&b[d].identifier<a.identifier)d++;d===c?b.push(a):b.splice(d,0,a)},getTouchVector:function(b,c){var d=this.debugMe&&a.settings.debug;md(this+".getTouchVector-1",d),md(this+".getTouchVector-1(x1: "+b.pageX+", y1: "+b.pageY+", x2: "+c.pageX+", y2: "+c.pageY+")",d);var e={x:c.pageX-b.pageX,y:c.pageY-b.pageY};return e.length=Math.sqrt(e.x*e.x+e.y*e.y),e.rotation=Math.atan2(e.y,e.x),e.cx=c.pageX+e.x/2,e.cy=c.pageY+e.y/2,md(this+".getTouchVector-2: l: "+e.length+", r: "+e.rotation+", cx: "+e.cx+", cy: "+e.cy,d),e},onDrag:function(b){var c=this.debugMe&&a.settings.debug;md(this+".onDrag-1",c);var d=b.listOfPointers,e,f,g,h,i;d.length>=2&&(md(this+".onDrag-2",c),e=this.getTouch(d[0].identifier),f=this.getTouch(d[1].identifier),i=this.getTouchVector({pageX:d[0].pageX,pageY:d[0].pageY},{pageX:d[1].pageX,pageY:d[1].pageY}),md(this+".onDrag-2, vector.length = "+i.length+", vector.rotation = "+i.rotation,c),h=i.length/this.touchDist,md(this+".onDrag-2, this.touchDist = "+this.touchDist+", this.touchRot = "+this.touchRot,c),this.rotateable&&(g=this.touchRot-i.rotation),md(this+".onDrag-3(rot:"+g+", zoom:"+h+")",c),this.setMatrix(g,h,0,0),md(this+".onDrag-4",c),this.applyTransform()),md(this+".onDrag-end",c)},onPressed:function(c){var d=this.debugMe&&a.settings.debug,e=c.listOfPointers,f,g,h,i;b.each(e,function(a){this.setTouchPos(a)},this);var j=this.touches;md(this+".onPressed: lopl = "+e.length,d);if(j.length>=2){f=j[0];for(var k in f)f.hasOwnProperty(k)&&md(this+".onPressed:touch0 = "+k,d);g=j[1],md(this+".onPressed: calc vector()",d),i=this.getTouchVector(f,g),md(this+".onPressed: calc transform()",d),h=this.getTransform(),this.touchDist=i.length/h.scale,md(this+".onPressed: touchDist = "+this.touchDist,d),this.rotateable&&(this.touchRot=h.rotation+i.rotation)}md(this+".onStartedDragging-2",d)},onReleased:function(c){var d=this.debugMe&&a.settings.debug;b.each(c.listOfPointers,function(a){md(this+".onReleased, removing:"+a,d),this.unsetTouchPos(a)},this)},onStoppedDragging:function(b){var c=this.debugMe&&a.settings.debug,d=b.listOfPointers,e,f=d.length,g=this.$target;md(this+".onStoppedDragging-1",c);for(e=0;e<f;e++)this.unsetTouchPos(d[e]);g.data("rotoZoomer-matrix",this.matrix.join(",")),g.data("rotoZoomer-rotateable",this.rotateable),g.data("rotoZoomer-zoomable",this.zoomable),g.data("rotoZoomer-autoapply",this.autoApply),md(this+".onStoppedDragging-2, data read(m: ["+g.data("rotoZoomer-matrix")+"], rotateable: "+g.data("rotoZoomer-rotateable")+", zoomable: "+g.data("rotoZoomer-zoomable")+", autoApply: "+g.data("rotoZoomer-autoapply")+")",c)},setTouchPos:function(b){var c=this.debugMe&&a.settings.debug;md(this+".setTouchPos-1",c);var d=this.globalToLocal(b),e={identifier:b.identifier,localX:d.localX,localY:d.localY,pageX:b.pageX,pageY:b.pageY};this.addTouch(e),md(this+".setTouchPos-4",c)},unsetTouchPos:function(a){var b=this.touches,c=b.length,d=0;while(d<c&&b[d].identifier!==a.identifier)d++;d<c&&b.splice(d,1)},getTouch:function(a){return b.find(this.touches,function(b){return a===b.identifier})},getTouchPos:function(a){var b=this.getTouch(a);return b||(b={identifier:a,localX:0,localY:0,pageX:0,pageY:0},this.addTouch(b)),this.localToGlobal(b)},applyTransform:function(){var b=this.debugMe&&a.settings.debug,c="matrix("+this.matrix.join(",")+")";this.autoApply&&(md(this+".autoApply",b),this.target.style.WebkitTransform=c,this.target.style.OTransform=c,this.target.style.MozTransform=c)},setTransform:function(a,b,c,d){this.setMatrix(a,b,c,d),this.applyTransform()},getTransform:function(){var a=this.matrix[0],b=this.matrix[2],c=Math.atan(b/a),d=a/Math.cos(c);return{scale:d,rotation:c}},setMatrix:function(b,c,d,e){var f=this.debugMe&&a.settings.debug;this.matrix[0]=Math.cos(b)*c,this.matrix[2]=Math.sin(b)*c,this.matrix[1]=-Math.sin(b)*c,this.matrix[3]=Math.cos(b)*c,this.matrix[4]=d,this.matrix[5]=e,md(this+".setMatrix(["+this.matrix.join(",")+"])",f)},localToGlobal:function(a){var b=this.matrix[0]*a.localX+this.matrix[2]*a.localY+1*this.matrix[4],c=this.matrix[1]*a.localX+this.matrix[3]*a.localY+1*this.matrix[5];return{pageX:b,pageY:c}},globalToLocal:function(a){var b=a.pageX-this.matrix[4],c=a.pageY-this.matrix[5],d=this.matrix[0]*this.matrix[3]-this.matrix[1]*this.matrix[2],e=(this.matrix[3]*b-this.matrix[2]*c)/d,f=(-this.matrix[1]*b+this.matrix[0]*c)/d;return{localX:e,localY:f}},toString:function(){return"rotoZoomer"}},a.RotoZoomer=c}(window.TipTap,_),function(a,b,c){var d=function(a,b){this.debugMe=!0,this.device=b,this.$el=a,this.listOfCallbacks={},this.listOfFilters=[],this.listOfActions=[],this.nofilter=!1};d.prototype={addActionListeners:function(a){a.pressed.add(this.callComboCallback,this),a.sendCombo.add(this.callComboCallback,this),a.dragStarted.add(this.callComboCallback,this),a.dragged.add(this.callComboCallback,this),a.dragStopped.add(this.callComboCallback,this),a.released.add(this.callComboCallback,this),a.finished.add(this.deallocateAction,this)},allocateAction:function(b){var c=this.debugMe&&a.settings.debug,d;md(this+".allocateAction-1",c),d=this.findActionByTarget(b.$target),d||(md(this+".allocateAction-couldn't find Action by target",c),d=new a.Action(b.$target),md(this+".allocateAction-new Action created",c),this.listOfActions.push(d),this.addActionListeners(d)),d.addFingerListeners(b),md(this+".allocateAction-end("+d+")",c)},bindCombos:function(b,c,e,f){var g;c===""?(this.nofilter=!0,c=a.GLOBAL_CLASS_FILTER):this.listOfFilters.push(c),g=d.comboToRegExp(b),this.listOfCallbacks[g]||(this.listOfCallbacks[g]={regex:new RegExp(g),callbacks:[]}),this.listOfCallbacks[g].callbacks.unshift({filter:c,callback:e,context:f})},callComboCallback:function(c,d){var e=this.debugMe&&a.settings.debug;md("<b>"+this+".callComboCallback("+c+", "+d+", "+c.gesture+")</b>",e),b.each(this.listOfCallbacks,function(e){if(e.regex.test(d)){var f=c.$target,g=f.is(this.$el)&&this.nofilter,h=b.find(e.callbacks,function(a){return f.is(a.filter)});if(!h&&g){var i=a.GLOBAL_CLASS_FILTER;h=b.find(e.callbacks,function(a){return a.filter===i})}h&&h.callback.call(h.context,c)}},this)},deallocateAction:function(b){var c=this.debugMe&&a.settings.debug;md(this+".deAllocateAction("+b+")",c),this.listOfActions.splice(this.listOfActions.indexOf(b),1)},findActionByTarget:function(a){return b.find(this.listOfActions,function(b){return b.$target.is(a)})},findMatchingFilterForEvent:function(c){var d;return d=b.find(this.listOfFilters,function(a){return c.is(a)}),!d&&this.nofilter?a.GLOBAL_CLASS_FILTER:d},toString:function(){return"R"}},d.comboToRegExp=function(c){var e=this.debugMe&&a.settings.debug;b.each(a.Gesture.statusMatchCode,function(a){c=c.replace(new RegExp(a.code,"g"),a.letter)});var f=c.split(a.settings.ComboAlternateOperator),g=[];return b.each(f,function(a){var b=d.transformComboIntoRegex(a);g.push(b)}),g.join("|")};var e=b.reduce(a.Gesture.statusMatchCode,function(a,b){return a+b.letter},"");d.lettersAndSeparatorsRE=new RegExp("["+e+a.settings.comboGesturesSep+a.settings.ComboParallelActionOperator+"]"),d.modifiersRE=/[\*\+\?]/,d.modifiersZeroOrRE=/[\*\?]/,d.numbersRE=/[0-9]/,d.transformComboIntoRegex=function(a){var b=a.length-1,c=0;return"^"+d.recursiveTransformCombo(a,b,c)},d.recursiveTransformCombo=function(b,c,e){var f=b.charAt(e++),g;if(d.lettersAndSeparatorsRE.test(f)){var h=f,i=0;while(e<=c&&d.numbersRE.test(b.charAt(e)))i=10*i+parseInt(b.charAt(e++),10);if(i>1)h+="{"+i+"}";else if(e<=c){f=b.charAt(e);if(d.modifiersRE.test(f)){var j=f;e++;if(d.modifiersZeroOrRE.test(f)&&e<=c){var k=b.charAt(e)===a.settings.ComboParallelActionOperator;k&&(e++,g=d.recursiveTransformCombo(b,c,e))}}}if(k)switch(j){case"?":h="("+g+"|"+h+"(?=-(?="+g+")))";break;case"*":h="("+g+"|"+h+"+(?=-(?="+g+")))";break;case"+":h+="+(?=-(?="+g+"))"}else j&&(h+=j),e<=c?h+="(?=("+d.recursiveTransformCombo(b,c,e)+"))":h+="$";return h}return""},a.Router=d}(window.TipTap,_,window.jQuery),function(a,b,c){var d=function(){this.debugMe=!0,this.START_EVENT="touchstart",this.DRAG_EVENT="touchmove",this.END_EVENT="touchend",this.CANCEL_EVENT="touchcancel"};d.prototype={buildEtList:function(d){var e=a.getEvent(d).changedTouches;return b.each(e,function(a){a.timeStamp=d.timeStamp,a.$target=c(a.target)}),e},onStart:function(a){},onDrag:function(a){},onEnd:function(a){},onCancel:function(a){},shouldCaptureDrag:function(a){return!0}},a.Touch=d}(window.TipTap,_,window.jQuery);